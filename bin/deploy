#!/bin/bash
set -e

cd "$(dirname "$0")/.."
# mkdir -p tmp/sockets

echo "ğŸ‘‰ Pulling latest code..."
git pull origin main

echo "ğŸ‘‰ Installing dependencies..."
bundle install
yarn install

echo "ğŸ‘‰ Building JS/CSS..."
yarn build
yarn build:css

echo "ğŸ‘‰ Precompiling assets..."
RAILS_ENV=production bundle exec rails assets:precompile

echo "ğŸ‘‰ Running migrations..."
RAILS_ENV=production bundle exec rails db:migrate

echo "ğŸ‘‰ Restarting Rails app..."
sudo systemctl restart rails

echo "âœ… Deploy complete!"
